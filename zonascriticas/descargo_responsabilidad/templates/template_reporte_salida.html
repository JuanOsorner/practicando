<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Reporte de Salida</title>
    <style>
        @page { size: letter portrait; margin: 2cm; }
        body { font-family: Helvetica, Arial, sans-serif; font-size: 10px; color: #333; }
        h1 { color: #352460; font-size: 16px; margin-bottom: 5px; }
        h2 { background: #eee; padding: 5px; font-size: 12px; border-bottom: 2px solid #352460; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 6px; text-align: left; vertical-align: top; }
        th { background-color: #f9f9f9; font-weight: bold; }
        .img-evidence { width: 80px; height: 80px; object-fit: cover; border: 1px solid #ddd; }
        .meta-info { margin-bottom: 20px; }
        .meta-info strong { color: #352460; }
    </style>
</head>
<body>
    <div class="header">
        <h1>REPORTE DE OPERACIONES Y SALIDA DE ZONA</h1>
        <p>JOLI FOODS S.A.S.</p>
    </div>

    <div class="meta-info">
        <p><strong>Usuario:</strong> {{ usuario.get_full_name }} ({{ usuario.numero_documento }})</p>
        <p><strong>Zona:</strong> {{ ubicacion.nombre }} - {{ ubicacion.ciudad }}</p>
        <p><strong>Entrada:</strong> {{ registro.fecha_hora_ingreso|date:"d/m/Y H:i" }}</p>
        <p><strong>Salida:</strong> {{ registro.fecha_hora_salida|date:"d/m/Y H:i" }}</p>
        <p><strong>Modalidad:</strong> {{ registro.get_modalidad_display }}</p>
    </div>

    {% if registro.modalidad == 'CON_EQUIPOS' and herramientas %}
    <h2>1. EQUIPOS Y HERRAMIENTAS INGRESADOS</h2>
    <table>
        <thead>
            <tr>
                <th>Equipo</th>
                <th>Marca/Serial</th>
                <th>Evidencia Entrada</th>
            </tr>
        </thead>
        <tbody>
            {% for item in herramientas %}
            <tr>
                <td>{{ item.herramienta_inventario.nombre }}</td>
                <td>{{ item.herramienta_inventario.marca_serial }}</td>
                <td>
                    {% if item.foto_evidencia %}
                        <img src="{{ item.foto_evidencia.path }}" class="img-evidence">
                    {% else %}
                        Sin Foto
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    {% if actividades %}
    <h2>2. BITÁCORA DE ACTIVIDADES</h2>
    <table>
        <thead>
            <tr>
                <th width="20%">Actividad</th>
                <th width="40%">Inicio</th>
                <th width="40%">Cierre</th>
            </tr>
        </thead>
        <tbody>
            {% for act in actividades %}
            <tr>
                <td>
                    <strong>{{ act.titulo }}</strong><br>
                    <span style="color:#666">{{ act.hora_inicio|date:"H:i" }} - {{ act.hora_fin|date:"H:i" }}</span>
                </td>
                <td>
                    {% if act.foto_inicial %}
                        <img src="{{ act.foto_inicial.path }}" class="img-evidence"><br>
                    {% endif %}
                    <em>{{ act.observacion_inicial }}</em>
                </td>
                <td>
                    {% if act.foto_final %}
                        <img src="{{ act.foto_final.path }}" class="img-evidence"><br>
                    {% endif %}
                    <em>{{ act.observacion_final }}</em>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="margin-top:10px; color:#666;">* No se registraron actividades específicas en la plataforma.</p>
    {% endif %}

    <div style="margin-top: 50px; text-align: center; font-size: 9px; color: #999;">
        Documento generado automáticamente por ZonasCriticasApp. ID Registro: {{ registro.id }}
    </div>
</body>
</html>